<Page xmlns="http://schemas.nativescript.org/tns.xsd" navigatingTo="navigatingTo" class="page">
  <ActionBar title="Open-IDE" class="action-bar">
    <ActionItem text="âŸ²" tap="onRefresh" ios.position="right" android.position="actionBar" />
    <ActionItem text="+" tap="onNewFile" ios.position="right" android.position="actionBar" />
  </ActionBar>
  
  <GridLayout rows="*, auto" class="main-container">
    <!-- Main Content Area -->
    <TabView row="0" class="tab-view">
      
      <!-- Project Explorer Tab - Only visible tab initially -->
      <TabViewItem title="ðŸ“ Explorer" class="tab-item">
        <GridLayout columns="200, *" class="explorer-content">
          
          <!-- File Tree Sidebar -->
          <StackLayout col="0" class="sidebar">
            <Label text="ðŸ“ Project Files" class="sidebar-title" />
            <ScrollView class="file-tree">
              <StackLayout>
                <Label text="{{ fileSystem.isLoading ? 'Loading...' : 'No files' }}" 
                       class="loading-text" 
                       visibility="{{ fileSystem.fileTree.length === 0 ? 'visible' : 'collapsed' }}" />
                <Repeater items="{{ fileSystem.fileTree }}" 
                          visibility="{{ fileSystem.fileTree.length > 0 ? 'visible' : 'collapsed' }}">
                  <Repeater.itemTemplate>
                    <StackLayout class="file-item" tap="onFileSelect">
                      <Label text="{{ type === 'folder' ? 'ðŸ“' : 'ðŸ“„' }} {{ name }}" class="file-name" />
                    </StackLayout>
                  </Repeater.itemTemplate>
                </Repeater>
              </StackLayout>
            </ScrollView>
          </StackLayout>
          
          <!-- Editor Area -->
          <GridLayout col="1" rows="auto, *" class="editor-area">
            <!-- Editor Tabs -->
            <ScrollView row="0" orientation="horizontal" class="tabs-container">
              <StackLayout orientation="horizontal" class="tabs">
                <Repeater items="{{ editorManager.tabs }}">
                  <Repeater.itemTemplate>
                    <GridLayout columns="*, auto" class="tab {{ isActive ? 'active' : '' }}" tap="onTabSelect">
                      <Label col="0" text="{{ name }}" class="tab-name" />
                      <Label col="1" text="Ã—" class="tab-close" tap="onTabClose" />
                    </GridLayout>
                  </Repeater.itemTemplate>
                </Repeater>
              </StackLayout>
            </ScrollView>
            
            <!-- Code Editor with Basic Syntax Highlighting -->
            <TextView row="1" id="editor-textarea" 
                      text="{{ editorManager.activeTab ? editorManager.activeTab.content : welcomeText }}" 
                      textChange="onEditorTextChange"
                      class="editor" />
          </GridLayout>
        </GridLayout>
      </TabViewItem>
      
      <!-- Hidden Advanced Tabs (Discoverable) - Users can uncomment these -->
      <!-- 
      <TabViewItem title="ðŸ”Œ Plugins" class="tab-item">
        <GridLayout class="plugins-content">
          <StackLayout class="plugin-manager">
            <Label text="Plugin System" class="feature-title" />
            <Label text="Extend Open-IDE functionality" class="feature-subtitle" />
            <ScrollView class="plugin-list">
              <StackLayout>
                <Label text="No plugins loaded. Uncomment plugin system to enable." class="empty-state" />
              </StackLayout>
            </ScrollView>
          </StackLayout>
        </GridLayout>
      </TabViewItem>
      
      <TabViewItem title="âš¡ Extensions" class="tab-item">
        <GridLayout class="extensions-content">
          <StackLayout class="extension-manager">
            <Label text="Extensions Manager" class="feature-title" />
            <Label text="Add custom features and tools" class="feature-subtitle" />
            <ScrollView class="extension-list">
              <StackLayout>
                <Label text="No extensions installed. Build your own extensions." class="empty-state" />
              </StackLayout>
            </ScrollView>
          </StackLayout>
        </GridLayout>
      </TabViewItem>
      
      <TabViewItem title="ðŸ–¥ï¸ Terminal" class="tab-item">
        <GridLayout rows="auto, auto, *" class="terminal-content">
          <GridLayout row="0" columns="*, auto" class="terminal-header">
            <Label col="0" text="Terminal - Command Line Interface" class="terminal-title" />
            <Button col="1" text="â–¶ï¸" tap="onExecuteCommand" class="execute-btn" />
          </GridLayout>
          <TextField row="1" hint="Enter command (e.g., ns build android)..." 
                     text="{{ terminalManager.currentCommand }}" 
                     class="command-input" />
          <ScrollView row="2" class="terminal-output">
            <StackLayout class="terminal-content">
              <Label text="Terminal ready. Type commands to execute builds and operations." 
                     class="terminal-text" 
                     visibility="{{ terminalManager.history.length === 0 ? 'visible' : 'collapsed' }}" />
              <Repeater items="{{ terminalManager.history }}">
                <Repeater.itemTemplate>
                  <StackLayout class="terminal-entry">
                    <Label text="$ {{ command }}" class="terminal-command" />
                    <Label text="{{ output }}" class="terminal-text" textWrap="true" />
                    <Label text="{{ error }}" class="terminal-error" textWrap="true" 
                           visibility="{{ error ? 'visible' : 'collapsed' }}" />
                  </StackLayout>
                </Repeater.itemTemplate>
              </Repeater>
            </StackLayout>
          </ScrollView>
        </GridLayout>
      </TabViewItem>
      -->
      
    </TabView>
    
    <!-- Console Panel -->
    <GridLayout row="1" rows="auto, *" class="console-panel" height="120">
      <GridLayout row="0" columns="*, auto, auto" class="console-header">
        <Label col="0" text="ðŸ–¥ï¸ Console" class="console-title" />
        <Button col="1" text="â–¶ï¸" tap="onExecute" class="execute-btn" />
        <Button col="2" text="ðŸ—‘ï¸" tap="onClearConsole" class="clear-btn" />
      </GridLayout>
      
      <ScrollView row="1" class="console-output">
        <StackLayout class="console-content">
          <Label text="Console ready. Execute code to see output." 
                 class="console-text" 
                 visibility="{{ runtimeExecutor.history.length === 0 ? 'visible' : 'collapsed' }}" />
          <Repeater items="{{ runtimeExecutor.history }}">
            <Repeater.itemTemplate>
              <StackLayout class="console-entry">
                <Label text="{{ output }}" class="console-text" textWrap="true" />
                <Label text="{{ error }}" class="console-error" textWrap="true" 
                       visibility="{{ error ? 'visible' : 'collapsed' }}" />
              </StackLayout>
            </Repeater.itemTemplate>
          </Repeater>
        </StackLayout>
      </ScrollView>
    </GridLayout>
  </GridLayout>
</Page>